# Capability: Insights Dashboard UI

**Capability ID:** `insights-dashboard-ui`  
**Change ID:** `add-react-frontend`

---

## ADDED Requirements

### Requirement: Generate Insights from Simulation

The UI MUST provide a way to generate AI-powered insights from simulation results.

**Acceptance Criteria:**
- "Generate Insights" button on insights page
- Loading state during insights generation (5-10 seconds)
- Automatic display of insights after generation
- Error handling if generation fails
- Navigate from simulation results to insights page

#### Scenario: Generate Insights for Draft

**Given** a user has completed a simulation for draft ID 456  
**And** navigates to `/insights/456`  
**When** the page loads  
**Then** a "Generate Insights" button displays  
**When** the user clicks the button  
**Then** the button changes to "Generating Insights..."  
**And** a loading indicator appears  
**And** after 5-10 seconds, insights are generated  
**And** the insights dashboard displays with full data

---

### Requirement: Display Aggregate Analytics

The insights page MUST show aggregated analytics from the simulation in a visual, easy-to-understand format.

**Acceptance Criteria:**
- Average scores for trust, excitement, backlash (from simulation)
- Overall sentiment classification (positive/neutral/negative)
- Score distribution visualization (optional chart)
- Summary statistics section
- Data matches simulation results exactly

#### Scenario: View Aggregate Analytics

**Given** insights have been generated for a draft  
**When** the insights dashboard loads  
**Then** an analytics section displays at the top showing:
  - Average Trust: 6.4/10 (with visual indicator)
  - Average Excitement: 7.2/10 (with visual indicator)
  - Average Backlash Risk: 2.8/10 (with visual indicator)
  - Overall Sentiment: "Positive" (with color badge)
**And** each metric uses the same color coding as simulation results  
**And** data matches the original simulation aggregate scores

---

### Requirement: Display Identified Pain Points

The UI MUST show all pain points identified by the AI with severity indicators.

**Acceptance Criteria:**
- List all pain points from insights
- Each pain point shows: text, severity, affected personas, reasoning
- Severity indicated by color and label (low/medium/high)
- Sortable by severity (high first)
- Expandable details for each pain point

#### Scenario: View Pain Points List

**Given** insights include 3 pain points  
**When** the pain points section displays  
**Then** 3 pain point cards are shown  
**And** each card shows:
  - The problematic text (e.g., "revolutionary")
  - Severity badge (e.g., "Medium" in yellow)
  - List of affected personas (e.g., "The Skeptic, The Veteran")
  - Reasoning text explaining the issue
**And** high severity items appear first  
**And** each severity level has distinct color:
  - High: Red (#EF4444)
  - Medium: Yellow (#F59E0B)
  - Low: Gray (#9CA3AF)

---

### Requirement: Display Improvement Tips

The UI MUST show actionable improvement tips generated by AI.

**Acceptance Criteria:**
- Display all improvement tips (typically 3)
- Each tip shows: category, suggestion, priority, expected impact
- Priority indicated by badge (low/medium/high)
- Tips organized by priority (high first)
- Copy-to-clipboard functionality for each tip

#### Scenario: View Improvement Tips

**Given** insights include 3 improvement tips  
**When** the tips section displays  
**Then** 3 tip cards are shown  
**And** each card shows:
  - Category (e.g., "Messaging", "Tone", "Specificity")
  - Suggestion text (e.g., "Replace 'revolutionary' with specific features")
  - Priority badge (e.g., "High" in red)
  - Expected impact (e.g., "Could reduce backlash risk by 30%")
**And** high priority tips appear first  
**And** a copy icon allows copying the suggestion text

---

### Requirement: AI-Generated Summary

The insights page MUST display an AI-generated summary of the overall analysis.

**Acceptance Criteria:**
- Summary paragraph (2-4 sentences)
- Highlights main concerns and opportunities
- Written in accessible language
- Displayed prominently at top or in dedicated section

#### Scenario: View Insights Summary

**Given** insights have been generated  
**When** the summary section is displayed  
**Then** a summary paragraph shows:
  "Your draft shows moderate trust levels with room for improvement. The use of 
  'revolutionary' and lack of specific details raised concerns among experienced 
  users. Focus on providing concrete information to build credibility while 
  maintaining the enthusiastic tone."
**And** the summary is easy to read and actionable  
**And** it's displayed in a highlighted box or section

---

### Requirement: Visual Score Distribution

The UI MUST support the capability to provide visual charts or graphs showing score distributions across personas when this feature is enabled.

**Acceptance Criteria:**
- Feature flag or configuration to enable/disable visualization
- Bar chart or similar visualization
- Shows distribution of trust, excitement, backlash scores
- Interactive tooltips on hover
- Responsive and readable on all devices
- Optional for MVP, can be added post-launch

#### Scenario: View Score Distribution Chart (Optional)

**Given** insights page includes visualization feature  
**When** the score distribution section loads  
**Then** a chart displays showing:
  - X-axis: Personas (5 names)
  - Y-axis: Score values (1-10)
  - Three colored lines/bars for trust, excitement, backlash
**When** user hovers over a data point  
**Then** a tooltip shows exact score and persona name  
**And** the chart is responsive to window resize

---

### Requirement: Link Back to Simulation Results

Users MUST be able to navigate back to the original simulation results from insights.

**Acceptance Criteria:**
- "View Simulation Results" or "Back to Results" link
- Link navigates to simulation results page
- Simulation ID preserved in navigation
- Breadcrumb or back button in header

#### Scenario: Navigate to Simulation Results

**Given** a user is on the insights page for draft ID 456  
**When** the user clicks "View Simulation Results"  
**Then** the application navigates to simulation results page  
**And** the original simulation data is displayed  
**And** all persona reactions are visible

---

### Requirement: Error Handling for Insights Generation

The UI MUST handle various error scenarios during insights generation.

**Acceptance Criteria:**
- API errors show user-friendly messages
- Retry option for failed generations
- Handle case when draft has no simulation
- Network errors display with guidance

#### Scenario: Handle Insights Generation Error

**Given** a user tries to generate insights for draft ID 456  
**When** the API returns a 500 Internal Server Error  
**Then** the loading state stops  
**And** an error message displays:
  "Failed to generate insights. Please try again."
**And** a "Retry" button is shown  
**When** user clicks "Retry"  
**Then** the insights generation is attempted again

#### Scenario: Handle Missing Simulation

**Given** a user navigates to `/insights/999` for non-existent draft  
**When** the page tries to load  
**Then** an error message displays:
  "No simulation found for this draft. Please run a simulation first."
**And** a link to return to simulation page is provided

---

### Requirement: Copy and Export Functionality

Users MUST be able to copy improvement tips for easy reference.

**Acceptance Criteria:**
- Copy button on each improvement tip
- Visual feedback when copied (tooltip or message)
- Clipboard API integration
- Fallback for browsers without clipboard support

#### Scenario: Copy Improvement Tip

**Given** a user is viewing improvement tips  
**When** the user clicks the copy icon next to a tip  
**Then** the tip suggestion text is copied to clipboard  
**And** a tooltip displays: "Copied!" for 2 seconds  
**And** the copy icon briefly changes to a checkmark  
**And** user can paste the tip into another application

---

### Requirement: Responsive Layout for Insights

Insights dashboard MUST be readable and functional on all target devices.

**Acceptance Criteria:**
- Desktop: Multi-column layout for sections
- Tablet: Single column or 2-column layout
- Mobile: Single column, stacked sections
- All charts/visualizations scale appropriately
- Touch-friendly interactions

#### Scenario: View Insights on Mobile

**Given** a user accesses insights page on a 375px screen  
**When** the page loads  
**Then** all sections stack vertically  
**And** aggregate scores display one per row  
**And** pain point cards are full width  
**And** text is readable without zooming  
**And** copy buttons are large enough for touch (min 44px)

---

### Requirement: Loading States for Insights

The UI MUST provide clear feedback during insights generation and loading.

**Acceptance Criteria:**
- Skeleton loaders while fetching existing insights
- Progress indicator during generation (5-10s)
- Disabled state on generate button during processing
- Estimated time message (optional)

#### Scenario: Show Loading State

**Given** a user is waiting for insights to generate  
**When** generation is in progress  
**Then** the "Generate Insights" button shows "Generating..."  
**And** a spinner animation displays  
**And** a message shows: "Analyzing simulation results..."  
**And** all interactive elements are disabled  
**And** after 5-10 seconds, insights appear

---

## Component Structure

### InsightsDashboard Component

```typescript
interface InsightsDashboardProps {
  draftId: number;
}
```

**State:**
- `insights`: Insights | null
- `generateMutation`: useMutation for generation
- `query`: useQuery for fetching existing insights

**Behavior:**
- Attempts to fetch existing insights on mount
- Provides button to generate if not exists
- Displays all insights sections when available

---

### AggregateAnalytics Component

```typescript
interface AggregateAnalyticsProps {
  analytics: AggregateAnalytics;
}
```

**Display:**
- Average scores with visual indicators
- Overall sentiment badge
- Optional score distribution chart

---

### PainPoints Component

```typescript
interface PainPointsProps {
  painPoints: PainPoint[];
}
```

**Display:**
- List of pain point cards
- Severity indicators
- Affected personas
- Reasoning text

---

### ImprovementTips Component

```typescript
interface ImprovementTipsProps {
  tips: ImprovementTip[];
}
```

**Display:**
- List of tip cards
- Priority badges
- Copy-to-clipboard buttons
- Expected impact text

---

## API Integration

### Generate Insights

**API Call:**
```typescript
generateInsights(draftId: number)
```

**Response:**
```typescript
{
  id: number,
  draft_id: number,
  aggregate_analytics: AggregateAnalytics,
  pain_points: PainPoint[],
  improvement_tips: ImprovementTip[],
  summary: string,
  created_at: string
}
```

---

### Get Insights

**API Call:**
```typescript
getInsights(insightId: number)
```

**Response:** Same as generate insights

---

## Styling Guidelines

### Colors
- **Severity/Priority High:** Red (#EF4444)
- **Severity/Priority Medium:** Yellow (#F59E0B)
- **Severity/Priority Low:** Gray (#9CA3AF)
- **Positive Sentiment:** Green (#10B981)
- **Neutral Sentiment:** Blue (#3B82F6)
- **Negative Sentiment:** Red (#EF4444)

### Layout
- **Dashboard Container:** Max width 1200px, centered
- **Section Spacing:** 32px between major sections
- **Card Grid:** 2-3 columns on desktop, 1 on mobile
- **Card Padding:** 24px

### Typography
- **Page Title:** 32px, bold
- **Section Headers:** 24px, semi-bold
- **Summary Text:** 16px, regular, line-height 1.6
- **Card Titles:** 18px, semi-bold
- **Body Text:** 14px, regular

### Components
- **Badges:** Border radius 16px, padding 4px 12px, font-size 12px, uppercase
- **Cards:** Border radius 8px, shadow, border on hover
- **Buttons:** Same as global button styles
- **Copy Icons:** 20px size, hover effect

---

## User Flow

1. **Access Insights:**
   - User completes simulation
   - Navigates to History page to see all simulations
   - Clicks on a simulation card to view full insights
   - Or navigates directly to `/insights/:draftId`

2. **Generate Insights:**
   - Insights are automatically generated in the background after simulation
   - Poll status endpoint to check if insights are ready
   - Insights display automatically when ready (5-10 seconds)

3. **Review Insights:**
   - Reads AI summary at top
   - Reviews aggregate analytics
   - Examines pain points by severity
   - Reads improvement tips

4. **Take Action:**
   - Copies improvement tips for reference
   - Returns to simulation to edit draft
   - Or runs new simulation with updated content

---

## Data Visualization (Optional for MVP)

### Score Distribution Chart
- **Library:** Chart.js or Recharts
- **Type:** Bar chart or line chart
- **Data:** 5 personas Ã— 3 scores
- **Interactions:** Hover tooltips, legend toggle
- **Responsive:** Scales to container width

### Sentiment Pie Chart (Optional)
- **Type:** Pie or donut chart
- **Data:** Distribution of positive/neutral/negative
- **Colors:** Green, blue, red
- **Labels:** Percentages and counts

---

## Accessibility

- **ARIA Labels:** All interactive elements
- **Keyboard Navigation:** Tab through all actions
- **Focus Indicators:** Visible focus states
- **Screen Reader:** Proper semantic HTML
- **Color Contrast:** WCAG AA compliant (4.5:1 minimum)

---

## Performance

- Insights generation: 5-10 seconds
- Page render: < 2 seconds after data fetch
- Copy action: Instant feedback
- Chart rendering: < 1 second (if included)
